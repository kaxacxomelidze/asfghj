RewriteEngine On

# Force HTTPS (except local development hosts)
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
RewriteCond %{HTTP_HOST} !^(localhost|127\.0\.0\.1)(:[0-9]+)?$ [NC]
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]


# Keep admin panel URLs unchanged
RewriteRule ^admin/ - [L]

# Redirect .php URLs (except admin) to clean URLs
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php([\s?]|$) [NC]
RewriteCond %1 !^admin/ [NC]
RewriteRule ^ %1 [R=301,L]

# Serve extensionless URLs from matching .php files
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L,QSA]

# Home
DirectoryIndex index.php
